

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Network Layer &mdash; billwear 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/dark_mode_js/default_dark.js?v=fd565c74"></script>
      <script src="../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Transport Layer" href="the-transport-layer-l4.html" />
    <link rel="prev" title="Interlayer addressing: ARP" href="arp.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            billwear
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">what's here?</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../philosophy/attention.html">The Quiet Art of Attention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../philosophy/change.html">Attention as Change</a></li>
<li class="toctree-l1"><a class="reference internal" href="../philosophy/credo.html">My Credo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../philosophy/kaizen.html">Kaizen, or the Mustard Seed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../philosophy/media-mindfulness.html">media mindfulness: how what we see becomes a part of us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../philosophy/motivation.html">Motivating with Thoughts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../philosophy/neither-here-nor-there.html">a day out of sync</a></li>
<li class="toctree-l1"><a class="reference internal" href="../philosophy/powering-through.html">powering through</a></li>
<li class="toctree-l1"><a class="reference internal" href="../philosophy/random.html">why i’m staying with canonical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../philosophy/truth.html">truth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../philosophy/whycanonical.html">But am I living my values?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../emacs/index.html">emacs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">networking</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="complicated-channels.html">Channels of Sharing are Complicated</a></li>
<li class="toctree-l2"><a class="reference internal" href="adversarial-beginnings.html">Adversarial Beginnings</a></li>
<li class="toctree-l2"><a class="reference internal" href="reinventing-the-internet.html">Reinventing the Internet</a></li>
<li class="toctree-l2"><a class="reference internal" href="the-physical-layer-l1.html">The Physical Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="the-datalink-layer-l2.html">The Datalink Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="arp.html">Interlayer addressing: ARP</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The Network Layer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-this-packets-you-speak-of-kimosabe">What is This “Packets” You Speak of, Kimosabe?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fixed-packet-lengths-and-segmented-messaging">Fixed Packet Lengths and Segmented Messaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ip-packets">IP Packets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#routing">Routing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="the-transport-layer-l4.html">The Transport Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="the-higher-layers.html">The Higher OSI Layers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../maas/index.html">MAAS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../impatience/index.html">the impatient visionary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../amusements/index.html">amusements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">billwear</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">networking</a></li>
      <li class="breadcrumb-item active">The Network Layer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/networking/the-network-layer-l3.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-network-layer">
<h1>The Network Layer<a class="headerlink" href="#the-network-layer" title="Link to this heading"></a></h1>
<p>You might have noticed in the original OSI model that “IP” was part of
Layer 3, and protocol stacks like UDP and TCP were part of Layer 4. It’s
a little bit confusing that we say “TCP/IP” when the “IP” really applies
to so many other protocols like UDP and ICMP. There are certainly other
protocols and protocol stacks, but for the purposes of these networks,
we’re talking almost exclusively about TCP/IP.</p>
<p>The network layer does not guarantee delivery. Essentially, it makes
every effort to deliver IP datagrams (packets) to the destination, but
it’s error-handling is pretty simple: just toss the packet into the
bit-bucket. It’s also a connectionless layer, meaning the packets
making up a message aren’t part of an ongoing conversation. They can
be split up, encoded, and sent separately, by different routes, and
arrive completely out of order. And packets can get duplicated or
corrupted.</p>
<p>Figuring all this out is the job of the protocol stack (e.g., TCP) in
layer 4. The network layer, L3, just delivers packets. Network byte
order: A rarely needed (but useful) fact is that the network sends
bytes in big endian order. That means bytes are transmitted starting
with bit 0 and working down to bit 31, usually eight bits at a time.</p>
<p>A lot of the computers on the Internet use little endian encoding,
which starts at the other end of the word. In those cases, the byte
order has to be reversed somewhere between the computer’s memory and
Layer 3. For most situations, that fact isn’t particularly useful, but
there is the occasional fault that involves failure to reverse byte
order along the path from RAM to NIC.</p>
<section id="what-is-this-packets-you-speak-of-kimosabe">
<h2>What is This “Packets” You Speak of, Kimosabe?<a class="headerlink" href="#what-is-this-packets-you-speak-of-kimosabe" title="Link to this heading"></a></h2>
<p>Packets are basic Internet Protocol (IP) message units. A message will
probably be split into multiple packets by L4 (the transport layer) so
it can be efficiently sent. For example, imagine that you’re sending a
very long letter to your friend, and all you have are lots of envelopes
and first-class stamps.</p>
<p>If you’ve ever done a lot of mailing, you’ll know that mailing a
one-ounce letter costs you, say, fifty-eight cents.  If you add
another ounce of paper to it, that second ounce only costs you, say,
twenty cents. But all you have are first class (i.e.,
fifty-eight-cent) stamps. If you don’t want to waste your money, you
can either cram more pages in the envelope, until you’re at three
ounces (the most you can get with two stamps), or send two letters,
each with one ounce in it.</p>
<p>The way envelopes go through the mailing system, you’re better off not
over-stuffing an envelope. So what do you do? You sit down and write
the letter to your friend, carefully numbering the pages.  Then you
divide it into piles of pages that are just under one ounce.  Finally,
you put each pile into an addressed, stamped envelope and mail each
letter separately. When your friend gets the letters, it doesn’t
matter which one gets there first, because they can reassemble your
message, using the page numbers.</p>
</section>
<section id="fixed-packet-lengths-and-segmented-messaging">
<h2>Fixed Packet Lengths and Segmented Messaging<a class="headerlink" href="#fixed-packet-lengths-and-segmented-messaging" title="Link to this heading"></a></h2>
<p>We could have designed computer networks to take messages of
indeterminate lengths, but that presents some unique challenges when
trying to manage network traffic. For example, suppose you send seven
overstuffed letters to your friend, and so does everyone else on your
block? All these huge letters aren’t going to fit in one
letter-carrier’s bag, so they’ll have to either send out two delivery
people, or wait until tomorrow to send out someone’s letters.</p>
<p>Choosing a fixed (relatively short) length makes it statistically
possible for everyone’s letters (everyone’s messages) to be delivered
at a fairly constant, reliable rate. That rate will vary with the size
of the overall message, not with who threw their message on the
Internet first.</p>
<p>A larger message takes longer to send. Messages are split into packets
of consistent length before they’re passed to L3, so larger messages
take longer. It’s statistically more efficient to split messages into
equally-sized packets than any other arrangement – the method that
gets the highest count of complete messages through the network in a
given amount of time. In network terminology, it’s the
highest-throughput approach to network traffic. Specifically, this
technique is called multiplexing.</p>
</section>
<section id="ip-packets">
<h2>IP Packets<a class="headerlink" href="#ip-packets" title="Link to this heading"></a></h2>
<p>The IP datagram (packet) is the backbone of most modern networks. The
datagram is preceded by an IPv4 header, which attaches to the front of
data packets up to about 65K long. Here are the header fields and what
information they carry:</p>
<blockquote>
<div><ul class="simple">
<li><p>IP Protocol Version: This is “4” for IPv4 and “6” for IPv6. There
are lots of others, but they generally don’t touch a typical
network.</p></li>
<li><p>Internet Header Length: The number of 32-bit words in the header,
including the options (but not including the data, since it’s just
the header). Most of the time, this will have the value “5”, but
options do exist and are sometimes included.</p></li>
<li><p>Differentiated Services Code Point: This is used to specify special
classes of service.  Normally, IP packets are delivered on a
“best-effort” basis, that is, Layer 3 will try everything possible
to make sure a packet gets delivered. You can cause L3 to deliver
packets with higher priority (implying more certainty) by using a
different DSCP.</p></li>
<li><p>ECN = Explicit Congestion Notification: These bits are both set by
an ECN-capable router when that router is above a certain traffic
threshold. They are there to alert a sender to slow down (or expect
delays) when the network segment in use is particularly
congested.</p></li>
<li><p>Total Length of IP Packet: This field indicates the length of the
entire packet, including the data. This makes it possible to
calculate the byte offset of the data within the datagram.</p></li>
<li><p>Identification: This is a serial number, generated by the sending
NIC, that helps the participants uniquely identify the datagram. In
a sense, it works like the little “take-a-number” tickets you get
at the hamburger stand: Eventually, the number will repeat, but the
repeat cycle is so long that there’s no chance of confusing
packets. The sequential nature of this field, when used in concert
with the Flags and Fragmentation Offset field, helps the protocol
stack correctly reassemble the message.</p></li>
<li><p>Flags: This field is basically used to indicate that a packet is a
fragment of a longer message.</p></li>
<li><p>Fragmentation Offset: Used with the Identification sequence number,
this field allows the system to know which packets precede or
follow this one when re-assembling the message.</p></li>
<li><p>Time to Live (TTL): This indicates the number of routers that a
datagram can pass through before it’s discarded. Since routers
function by replacing their own destination address with the IP
address of the next hop, this essentially limits the number of
times a packet’s destination IP can be changed. Most RFC documents
suggest keeping this number at 64, it’s more often set to something
like 255 without any real bottlenecks.</p></li>
<li><p>Protocol: This field indicates the higher level protocol (the
protocol stack) that generated this message. Examples are given for
TCP and UDP in the figure.</p></li>
<li><p>Header Checksum: This calculates a checksum for the header
only. It’s only used in IPv4. Doing integrity-checking on the data
is the responsibility of Layer 4.</p></li>
<li><p>Source Address: This is the IP address of the sender of the packet,
for this hop only. As shown in the figure below, routers will
change this address so they can get the answer back.</p></li>
<li><p>Destination Address: This is the IP address of the destination, for
this hop only. As shown below, routers change this address to act
as brokers in the IP chain.</p></li>
</ul>
</div></blockquote>
</section>
<section id="routing">
<h2>Routing<a class="headerlink" href="#routing" title="Link to this heading"></a></h2>
<p>We now have enough concepts in play to talk about routing. Routing takes
place at the network layer, by changing the source and destination
addresses (without losing track of the replaced address). The process
looks something like this: The router typically assigns a unique port
number to the outbound message, and records the source IP against that
port number. When the message comes back to it on that port number, it
can look up the IP address of the NIC that sent the packet and route the
answer back.</p>
<hr class="docutils" />
<p>Copyright (C) 2024 by Bill Wear; All Rights Reserved</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="arp.html" class="btn btn-neutral float-left" title="Interlayer addressing: ARP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="the-transport-layer-l4.html" class="btn btn-neutral float-right" title="The Transport Layer" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, bill wear.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>